<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Image â†’ URL â€” Toolgenix</title>
<meta name="description" content="Convert images to data URLs, blob URLs or upload to Imgur. Private client-side operation.">
<style>
:root{
  --bg:#071025; --panel:#0e1724; --muted:#9fb0c7; --accent:#39d98a; --accent2:#7c5cff;
  --glass: rgba(255,255,255,0.03); --radius:12px;
  --max-preview-width:420px;
}
*{box-sizing:border-box}
body{
  margin:0; font-family:Inter,system-ui,Arial,Helvetica,sans-serif; background:linear-gradient(180deg,var(--bg),#02111a); color:#eaf6ff; padding:20px;
}
.container{max-width:1100px;margin:0 auto}
.header{display:flex;justify-content:space-between;align-items:center;gap:12px}
.brand h1{margin:0;color:var(--accent)} .brand p{margin:0;color:var(--muted);font-size:13px}
.grid{display:grid;grid-template-columns:420px 1fr; gap:14px; margin-top:14px}
@media(max-width:980px){.grid{grid-template-columns:1fr}}

.card{background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.005)); padding:12px; border-radius:12px; border:1px solid rgba(255,255,255,0.03)}
.uploader{padding:16px;border-radius:10px;background:var(--panel);border:1px dashed rgba(255,255,255,0.03);text-align:center;cursor:pointer}
.uploader.drag{box-shadow:0 10px 40px rgba(0,0,0,0.6) inset;border-color:rgba(122,255,170,0.2)}
.small{font-size:13px;color:var(--muted)}
.row{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
.btn{padding:10px 12px;border-radius:10px;border:none;cursor:pointer;background:linear-gradient(90deg,var(--accent),var(--accent2));color:#022;font-weight:800}
.btn.ghost{background:transparent;border:1px solid rgba(255,255,255,0.03);color:var(--muted)}
.preview{display:flex;gap:12px;align-items:center;flex-wrap:wrap;margin-top:10px}
.previewCard{background:var(--glass);padding:10px;border-radius:10px;min-width:220px;max-width:var(--max-preview-width)}
.previewCard img{display:block;max-width:100%;height:auto;border-radius:8px}
.meta{font-size:13px;color:var(--muted);margin-top:6px}
.actions{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
textarea {width:100%;min-height:120px;padding:10px;border-radius:8px;border:none;background:rgba(255,255,255,0.02);color:inherit;resize:vertical}
.copyBtn{background:linear-gradient(90deg,#ffd66b,#ff8a6b); color:#022}
.info{font-size:13px;color:var(--muted);margin-top:8px}
.footer{margin-top:12px;color:var(--muted);font-size:13px;text-align:center}
.tip{font-size:13px;color:var(--muted);margin-top:8px}
.badge{display:inline-block;padding:6px 8px;border-radius:8px;background:rgba(255,255,255,0.02);color:var(--muted);font-weight:700}
.copySuccess{color:#39d98a;font-weight:700}
</style>
</head>
<body>
<div class="container">
  <div class="header">
    <div class="brand">
      <h1>Image â†’ URL</h1>
      <p class="small">Convert images to Data URL (base64) or Blob URL. Optional: upload to Imgur with your Client-ID.</p>
    </div>
    <div class="small">Supported: PNG Â· JPG Â· JPEG Â· WEBP Â· GIF Â· BMP Â· TIFF</div>
  </div>

  <div class="grid">
    <!-- Left: controls -->
    <section class="card">
      <div id="dropZone" class="uploader" tabindex="0">
        <div style="font-size:28px">ðŸ“¤</div>
        <div style="font-weight:700;margin-top:6px">Drop image(s) here or click to select</div>
        <div class="small" style="margin-top:6px">You can upload multiple images. All processing stays in your browser unless you choose to upload to Imgur.</div>
        <input id="fileInput" type="file" accept="image/*" multiple style="display:none">
      </div>

      <div style="margin-top:12px" class="row">
        <button id="clearAll" class="btn ghost">Clear All</button>
        <button id="generateAll" class="btn">Generate URLs for All</button>
        <div style="flex:1"></div>
        <div class="small">Limit: 25MB per file recommended</div>
      </div>

      <hr style="border:none;border-top:1px solid rgba(255,255,255,0.03);margin:12px 0">

      <div class="small" style="font-weight:700">Imgur Upload (optional)</div>
      <div class="tip">If you want public image hosting, paste your <span class="badge">Imgur Client-ID</span> below (keeps your key local). Learn: https://api.imgur.com/</div>
      <div style="margin-top:8px" class="row">
        <input id="imgurClientId" class="input" placeholder="Client-ID (optional)" style="padding:8px;border-radius:8px;background:var(--glass);color:inherit;border:none;flex:1">
        <button id="testImgur" class="btn ghost">Test</button>
      </div>
      <div id="imgurTestResult" class="meta"></div>

      <div style="margin-top:12px" class="small" style="font-weight:700">Settings</div>
      <div style="margin-top:8px" class="row">
        <label class="small" style="display:flex;align-items:center;gap:8px"><input id="includeDataUrl" type="checkbox" checked>Include Data URL</label>
        <label class="small" style="display:flex;align-items:center;gap:8px"><input id="includeBlobUrl" type="checkbox" checked>Include Blob URL</label>
      </div>

      <div style="margin-top:12px" class="info">Tip: Data URLs are convenient for embedding in HTML/CSS but are long (base64). Blob URLs are short and temporary (valid in this browser session). Use Imgur for persistent public URLs.</div>
    </section>

    <!-- Right: previews & outputs -->
    <aside class="card">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div style="font-weight:700">Preview & Output</div>
        <div class="small">Actions per image</div>
      </div>

      <div id="previews" class="preview" aria-live="polite" style="margin-top:10px"></div>

      <hr style="border:none;border-top:1px solid rgba(255,255,255,0.03);margin:12px 0">

      <div class="small" style="font-weight:700">Batch Output (Selected)</div>
      <div style="margin-top:8px">
        <label class="small">Choose output format for download</label>
        <select id="batchFormat" style="padding:8px;border-radius:8px;background:var(--glass);border:none;color:inherit">
          <option value="json">JSON (name + urls)</option>
          <option value="txt">TXT (base64 list)</option>
        </select>
        <div style="margin-top:8px" class="row">
          <button id="downloadBatch" class="btn ghost">Download Batch</button>
          <button id="uploadImgurBatch" class="btn">Upload All to Imgur</button>
        </div>
      </div>

    </aside>
  </div>

  <div class="footer">Built for Toolgenix â€” Your images stay private unless you choose to upload. Need server-side hosting? Ask me.</div>
</div>

<script>
/* Image â†’ URL Tool
 - Handles multiple files
 - Creates previews, data URLs (base64), blob URLs
 - Copy / Download / Optional Imgur upload (anonymous with Client-ID)
*/

// Helpers
const $ = id => document.getElementById(id);
const allowedTypes = /^image\/(png|jpe?g|webp|gif|bmp|tiff?)$/i;
const maxFileMB = 50;

function humanFileSize(bytes) {
  if (!bytes) return '0 B';
  const i = Math.floor(Math.log(bytes) / Math.log(1024));
  const sizes = ['B','KB','MB','GB','TB'];
  return (bytes / Math.pow(1024, i)).toFixed(i ? 2 : 0) + ' ' + sizes[i];
}

// State
let items = []; // { id, file, dataUrl?, blobUrl?, imgEl, generated: { dataUrl, blobUrl, imgurUrl } }

const dropZone = $('dropZone'), fileInput = $('fileInput'), previews = $('previews');
const clearAllBtn = $('clearAll'), generateAllBtn = $('generateAll');
const includeDataUrl = $('includeDataUrl'), includeBlobUrl = $('includeBlobUrl');
const imgurClientIdInput = $('imgurClientId'), testImgurBtn = $('testImgur'), imgurTestResult = $('imgurTestResult');
const downloadBatchBtn = $('downloadBatch'), uploadImgurBatch = $('uploadImgurBatch'), batchFormat = $('batchFormat');

// Drag & drop
dropZone.addEventListener('click', ()=> fileInput.click());
;['dragenter','dragover'].forEach(ev => dropZone.addEventListener(ev, e=> { e.preventDefault(); e.stopPropagation(); dropZone.classList.add('drag'); }));
;['dragleave','drop'].forEach(ev => dropZone.addEventListener(ev, e=> { e.preventDefault(); e.stopPropagation(); dropZone.classList.remove('drag'); }));
dropZone.addEventListener('drop', e => {
  const fs = e.dataTransfer.files;
  handleFiles(fs);
});
fileInput.addEventListener('change', e => handleFiles(e.target.files));

function handleFiles(fileList){
  const arr = Array.from(fileList);
  for(const f of arr){
    if(!allowedTypes.test(f.type) && !f.name.match(/\.(png|jpe?g|webp|gif|bmp|tiff?)$/i)){
      alert('Unsupported file type: ' + f.name); continue;
    }
    if(f.size > maxFileMB * 1024 * 1024){
      if(!confirm(`${f.name} is large (${humanFileSize(f.size)}). Continue?`)) continue;
    }
    addItem(f);
  }
  renderPreviews();
}

function addItem(file){
  const id = cryptoRandomId();
  const obj = { id, file, generated: {} };
  items.push(obj);
}

// small random id
function cryptoRandomId(){ return Math.random().toString(36).slice(2,10); }

function renderPreviews(){
  previews.innerHTML = '';
  if(items.length === 0){ previews.innerHTML = '<div class="small">No images yet</div>'; return; }

  items.forEach(it => {
    const card = document.createElement('div'); card.className = 'previewCard';
    // Image preview
    const img = document.createElement('img');
    img.alt = it.file.name;
    img.src = URL.createObjectURL(it.file);
    img.onload = () => URL.revokeObjectURL(img.src); // free memory
    // Meta
    const meta = document.createElement('div'); meta.className = 'meta';
    meta.innerHTML = `<div style="font-weight:700">${it.file.name}</div>
                      <div class="small">${humanFileSize(it.file.size)} Â· ${img.naturalWidth || 'â€”'}Ã—${img.naturalHeight || 'â€”'}</div>`;
    // Actions: Generate, Copy, Download, ImgUR
    const actions = document.createElement('div'); actions.className = 'actions';
    const genBtn = document.createElement('button'); genBtn.textContent = 'Generate URL'; genBtn.className='btn ghost';
    genBtn.onclick = async () => { await generateForItem(it, card); };

    const copyDataBtn = document.createElement('button'); copyDataBtn.textContent = 'Copy Data URL'; copyDataBtn.className='btn copyBtn';
    copyDataBtn.onclick = async () => { if(!it.generated.dataUrl) await generateForItem(it, card); if(it.generated.dataUrl) { navigator.clipboard.writeText(it.generated.dataUrl); alert('Data URL copied to clipboard'); } };

    const copyBlobBtn = document.createElement('button'); copyBlobBtn.textContent = 'Copy Blob URL'; copyBlobBtn.className='btn ghost';
    copyBlobBtn.onclick = async () => { if(!it.generated.blobUrl) await generateForItem(it, card); if(it.generated.blobUrl) { navigator.clipboard.writeText(it.generated.blobUrl); alert('Blob URL copied'); } };

    const downloadBtn = document.createElement('button'); downloadBtn.textContent = 'Download Image'; downloadBtn.className='btn';
    downloadBtn.onclick = async () => {
      // download original file
      const a = document.createElement('a'); a.href = URL.createObjectURL(it.file); a.download = it.file.name; a.click();
    };

    const downloadDataBtn = document.createElement('button'); downloadDataBtn.textContent = 'Download Data URL (.txt)'; downloadDataBtn.className='btn ghost';
    downloadDataBtn.onclick = async () => {
      if(!it.generated.dataUrl) await generateForItem(it, card);
      if(it.generated.dataUrl){
        const blob = new Blob([it.generated.dataUrl], { type: 'text/plain' });
        const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = it.file.name + '.dataurl.txt'; a.click();
      }
    };

    const uploadImgurBtn = document.createElement('button'); uploadImgurBtn.textContent = 'Upload â†’ Imgur'; uploadImgurBtn.className='btn';
    uploadImgurBtn.onclick = async () => {
      try {
        await ensureGenerated(it);
        await uploadToImgur(it);
        // show saved link
        await generateForItem(it, card);
      } catch (err) { alert('Imgur upload failed: '+err.message); }
    };

    const removeBtn = document.createElement('button'); removeBtn.textContent = 'Remove'; removeBtn.className='btn ghost';
    removeBtn.onclick = () => { items = items.filter(x=>x.id!==it.id); renderPreviews(); };

    // Append actions depending on settings
    actions.appendChild(genBtn);
    if(includeDataUrl.checked) actions.appendChild(copyDataBtn);
    if(includeBlobUrl.checked) actions.appendChild(copyBlobBtn);
    actions.appendChild(downloadBtn);
    if(includeDataUrl.checked) actions.appendChild(downloadDataBtn);
    actions.appendChild(uploadImgurBtn);
    actions.appendChild(removeBtn);

    card.appendChild(img);
    card.appendChild(meta);
    card.appendChild(actions);

    // show generated outputs area
    const outArea = document.createElement('div'); outArea.style.marginTop='8px';
    outArea.className = 'meta';
    outArea.innerHTML = `<div id="out-${it.id}">Not generated</div>`;
    card.appendChild(outArea);

    previews.appendChild(card);
  });
}

// Generate URLs for items (batch)
generateAllBtn.addEventListener('click', async ()=>{
  if(items.length===0) return alert('No images to process');
  for(const it of items){
    const card = document.querySelector(`[id^="out-${it.id}"]`)?.parentElement || null;
    await generateForItem(it, card);
  }
  alert('Generated for all images');
});

// Clear all
clearAllBtn.addEventListener('click', ()=> { if(confirm('Clear all images?')){ items=[]; renderPreviews(); } });

// Ensure generate
async function ensureGenerated(it){
  if(!it.generated.dataUrl && includeDataUrl.checked){
    await generateDataUrl(it);
  }
  if(!it.generated.blobUrl && includeBlobUrl.checked){
    await generateBlobUrl(it);
  }
}

// Generate for single item and update UI
async function generateForItem(it, cardElement){
  try {
    const outDiv = cardElement ? cardElement.querySelector(`#out-${it.id}`) : null;
    if(outDiv) outDiv.innerHTML = 'Generatingâ€¦';
    if(includeDataUrl.checked) await generateDataUrl(it);
    if(includeBlobUrl.checked) await generateBlobUrl(it);
    // update UI
    const lines = [];
    if(it.generated.dataUrl) lines.push(`<div style="word-break:break-all"><b>Data URL</b><br/><textarea readonly>${it.generated.dataUrl}</textarea></div>`);
    if(it.generated.blobUrl) lines.push(`<div style="word-break:break-all"><b>Blob URL</b><br/><input readonly style="width:100%" value="${it.generated.blobUrl}"/></div>`);
    if(it.generated.imgurUrl) lines.push(`<div><b>Imgur</b><br/><a target="_blank" href="${it.generated.imgurUrl}">${it.generated.imgurUrl}</a></div>`);
    if(outDiv) outDiv.innerHTML = lines.join('<hr/>');
  } catch (err) {
    if(cardElement) cardElement.querySelector(`#out-${it.id}`).innerText = 'Error: '+err.message;
    console.error(err);
  }
}

// Create data URL
async function generateDataUrl(it){
  if(it.generated.dataUrl) return it.generated.dataUrl;
  const file = it.file;
  const fr = new FileReader();
  const p = new Promise((resolve, reject)=>{
    fr.onload = ()=> resolve(fr.result);
    fr.onerror = (e)=> reject(e);
  });
  fr.readAsDataURL(file);
  const dataUrl = await p;
  it.generated.dataUrl = dataUrl;
  return dataUrl;
}

// Create blob URL
async function generateBlobUrl(it){
  if(it.generated.blobUrl) return it.generated.blobUrl;
  // Use createObjectURL pointing to file
  const blobUrl = URL.createObjectURL(it.file);
  it.generated.blobUrl = blobUrl;
  return blobUrl;
}

// Imgur upload
async function uploadToImgur(it){
  const clientId = imgurClientIdInput.value.trim();
  if(!clientId) throw new Error('Provide Imgur Client-ID in the left panel (optional). See: https://api.imgur.com/');
  // ensure we have blob or data
  await ensureGenerated(it);
  // prefer dataURL -> strip prefix back to binary
  let blob;
  if(it.generated.dataUrl){
    // convert dataURL to blob
    const res = await fetch(it.generated.dataUrl);
    blob = await res.blob();
  } else {
    blob = it.file;
  }
  // prepare form
  const form = new FormData();
  form.append('image', blob);
  // optional: name
  form.append('type', 'file');
  // Upload
  const res = await fetch('https://api.imgur.com/3/image', {
    method: 'POST',
    headers: { Authorization: 'Client-ID ' + clientId },
    body: form
  });
  const j = await res.json();
  if(!j || !j.success) throw new Error('Imgur upload failed: '+(j?.data?.error || JSON.stringify(j)));
  const url = j.data.link;
  it.generated.imgurUrl = url;
  return url;
}

// Test Imgur client ID
testImgurBtn.addEventListener('click', async ()=>{
  const id = imgurClientIdInput.value.trim();
  if(!id) return imgurTestResult.innerText = 'Enter a Client-ID to test';
  imgurTestResult.innerText = 'Testingâ€¦';
  try {
    // upload tiny test 1x1 png
    const tiny = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8Xw8AAn8B9Qq9qQAAAABJRU5ErkJggg==';
    const res = await fetch(tiny);
    const blob = await res.blob();
    const form = new FormData(); form.append('image', blob);
    const r = await fetch('https://api.imgur.com/3/image', { method:'POST', headers: { Authorization: 'Client-ID '+id }, body: form });
    const j = await r.json();
    if(j && j.success) { imgurTestResult.innerHTML = '<span class="copySuccess">Imgur Client-ID OK â€” test upload succeeded</span>'; }
    else imgurTestResult.innerText = 'Imgur test failed â€” check Client-ID and network';
  } catch (err) {
    imgurTestResult.innerText = 'Imgur test error: '+err.message;
  }
});

// Batch download logic
downloadBatchBtn.addEventListener('click', async ()=>{
  if(items.length===0) return alert('No images');
  const format = batchFormat.value;
  const output = [];
  for(const it of items){
    await ensureGenerated(it);
    output.push({ name: it.file.name, dataUrl: it.generated.dataUrl || null, blobUrl: it.generated.blobUrl || null, imgurUrl: it.generated.imgurUrl || null });
  }
  if(format === 'json'){
    const blob = new Blob([JSON.stringify(output, null, 2)], { type: 'application/json' });
    const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = 'image-urls.json'; a.click();
  } else {
    // TXT: each base64 in newline separated
    const txt = output.map(o => (o.name + '\n' + (o.dataUrl || o.imgurUrl || o.blobUrl || ''))).join('\n\n');
    const blob = new Blob([txt], { type: 'text/plain' });
    const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = 'image-urls.txt'; a.click();
  }
});

// Batch upload to Imgur
uploadImgurBatch.addEventListener('click', async ()=>{
  const clientId = imgurClientIdInput.value.trim();
  if(!clientId) return alert('Provide Imgur Client-ID in left panel first');
  if(items.length===0) return alert('No images');
  if(!confirm(`Upload ${items.length} image(s) to Imgur? This will use your Client-ID.`)) return;
  for(const it of items){
    try {
      await ensureGenerated(it);
      await uploadToImgur(it);
      // update preview area for that item
      const el = document.querySelector(`#out-${it.id}`);
      if(el) generateForItem(it, el.parentElement);
    } catch (err) {
      console.error('Upload failed for', it.file.name, err);
    }
  }
  alert('Batch Imgur upload complete (check previews for links).');
});

// initialize
renderPreviews();

</script>
</body>
</html>
